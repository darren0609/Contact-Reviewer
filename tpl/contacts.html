<!DOCTYPE html>
<html>
<head>
  <title>Office 365 API - Contacts - Example</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="navbar">
        <a class="navbar-brand" href="/">{{ .me.Givenname }} {{ .me.Surname }}</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <li class="nav-item" id='home-nav'><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item" id='inbox-nav'><a class="nav-link" href="/home">Inbox</a></li>
          <li class="nav-item" id='calendar-nav'><a class="nav-link disabled" href="/events">Calendar</a></li>
          <li class="nav-item" id='contacts-nav'><a class="nav-link" href="/contacts">Contacts</a></li>
        </ul>
      </div>
      </div>
    </div>
  </nav>

<main role="main">  
<div class="jumbotron">
  <h1 class="display-3">Contact listing</h1>
  <p class="lead">Current list of all contacts.</p>

  <form id="search-form" onsubmit="return false">
    <input name="search" />
    <input type="submit" value="Search" onclick="submitSearch()" />
  </form>

  <hr class="my-2">
  </p>
  <div class="table-responsive pull-center" style="width:100%;">
    <table id="contact-listing" width="100%" class="table table-striped table-bordered table-hover">
        <thead>
          <tr class="info">
          <th onclick="sortContacts('firstname')">First Name</th>
          <th onclick="sortContacts('secondname')">Second Name</th>
          <th onclick="sortContacts('emailaddress')">Email Address</th>
          <th onclick="sortContacts('workphone')">Work Phone</th>
          <th onclick="sortContacts('mobilephone')">Mobile Phone</th>
          <th onclick="sortContacts('homephone')">Home Phone</th>
          <th >Action</th>
          </tr>
        </thead>
          <tbody>
            {{range .contact.Contacts }}
          <tr>
          <td>{{ .Givenname }}</td>
          <td>{{ .Surname }}</td>
          <td>{{ range .Emailaddresses }} {{ . }} {{ end }} </td>
          <td>{{ range .Officephone }} {{ . }} {{ end }} </td>
          <td>{{ .Mobilephone }}</td>
          <td>{{ range .Homephone }} {{ . }} {{ end }}</td>
          <td align="center"><button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target=".modal1">Edit</button></td>
          </tr>
          {{ end }}
          </tbody>
      </table>
    </div>
    </div>
</div>    
<script type="text/javascript" src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
<script type="text/javascript">
  function submitSearch() {
    $.ajax({
      url: "/contacts",
      method: "POST",
      data: $("#search-form").serialize(),
      success: function(rawData) {
        var parsed = JSON.parse(rawData);
        if (!parsed) return;

        var searchResults = $("#search-results");
        searchResults.empty();

        parsed.forEach(function(result) {
          var row = $("<tr><td>" + result.Title + "</td><td>" + result.Author + "</td><td>" + result.Year +  "</td><td>" + result.ID + "</td></tr>");
          searchResults.append(row);
          row.on("click", function() {
            $.ajax({
              url: "/books/add?id=" + result.ID,
              method: "GET"
            })
          })
        });
      }
    });
    return false;
  }
</script>    
</main>
</body>
</html>
