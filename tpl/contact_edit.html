<!DOCTYPE html>
<html>
<head>
  <title>Edit Contact - Office 365 API</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <div class="navbar">
        <a class="navbar-brand" href="/home">{{ .me.Givenname }} {{ .me.Surname }}</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav bd-navbar-nav flex-row">
          <!-- <li class="nav-item" id='home-nav'><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item" id='inbox-nav'><a class="nav-link" href="/home">Inbox</a></li>
          <li class="nav-item" id='calendar-nav'><a class="nav-link disabled" href="/events">Calendar</a></li>-->
          <li class="nav-item" id='contacts-nav'><a class="nav-link" href="/home">Contact Listing</a></li>
        </ul>
      </div>
      </div>
    </div>
  </nav>

<main role="main">  
<div class="jumbotron">
  <h1 class="display-3">Contact listing</h1>
  <p class="lead">Current list of all contacts.</p>

  <hr class="my-2">

</p>
<!--<form id="search-form" onsubmit="return false">
  <div class="form-group row">
  <div class="col-sm-5"><input name="search" class="form-control form-control-lg" type="text" placeholder=""></div>
  <input type="submit" class="btn btn-default btn-xs" value="Search" onclick="submitSearch()" /></div>
</form>-->
<br><br>
  <div class="table-responsive pull-center" style="width:100%;">
      
  
    <table width="100%" class="table table-striped table-bordered table-hover">
        <thead id="contact-listing">
          <tr class="info">
          <th onclick="sortContacts('givenName')">First Name</th>
          <th onclick="sortContacts('surname')">Second Name</th>
          <th>Email Address(es)</th>
          <th>Work Phone</th>
          <th>Mobile Phone</th>
          <th>Home Phone</th>
          <th >Action</th>
          <th onclick="showViewPage()"><button type="button" class="btn btn-outline-dark">Contact</button></th>
          </tr>
        </thead>
        <thead id="view-page">
          <tr class="info">
          <th>First Name</th>
          <th>Second Name</th>
          <th>Email Address(es)</th>
          <th>Work Phone</th>
          <th>Mobile Phone</th>
          <th>Home Phone</th>
          <th>Edit/Delete</th>
          <th onclick="showSearchPage()"><button type="button" class="btn btn-outline-dark">Search</button></th>
          </tr>
        </thead>
          <tbody id="contact-listing"></tbody>
          <tbody id="view-page"></tbody>
      </table>
    </div>
    </div>
</div>    
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<script type="text/javascript">

  $( document ).ready(showViewPage)

  function showViewPage() {
        $("#contact-listing").hide()
        $("#view-page").show()
      }
      function showSearchPage() {
        $("#contact-listing").show()
        $("#view-page").hide()
      }
      function submitSearch() {
        $.ajax({
          url: "/contacts",
          method: "GET",
          data: $("#search-form").serialize(),
          success: function(rawData) {
            var parsed = JSON.parse(rawData);
            if (!parsed) return;
          
            var contactListing = $("#contact-listing");
            contactListing.empty();

            parsed.value.forEach(function(result) {
              appendContact(contactListing, result);
              
            });
                      }
        }); 
        return false;
      }

      function rebuildContacts(result) {
        var parsed = JSON.parse(result);
        if (!parsed) return;
        var contactListing = $("#contact-listing");
        contactListing.empty();
    
        parsed.value.forEach(function(result) {
            appendContact(contactListing, result);
        });
      }

      function sortContacts(columnName) {
        $.ajax({
          method: "GET",
          url: "/contacts?sortBy=" + columnName,
          success: rebuildContacts
        })
      }

  function appendContact(contactListing, contact) {
     var emailcheck = ""
     if (contact.emailAddresses.length == 0) {
       emailcheck = "";
     } else {
       for (i = 0; i < contact.emailAddresses.length; i++) {
         if (emailcheck.length > "") {
           emailcheck = emailcheck + "; ";
         }

         if (contact.emailAddresses[i].address.length == 0) {
            emailcheck = emailcheck + "BLANK";
         } else {
        emailcheck = emailcheck + contact.emailAddresses[i].address
         }
       }
  
     }
    var row = $("<tr><td>" + contact.givenName + "</td><td>" + contact.surname + "</td><td>" + emailcheck + "</td><td>" + contact.businessPhones + "</td><td>" + contact.mobilePhone +"</td><td>" + contact.homePhones + "<td align=\"center\"><a href=\"../contacts/" + contact.id + "\" class=\"btn btn-default btn-xs\" data-toggle=\"modal\" data-target=\".modal1\">Edit</a></td></tr>");
    contactListing.append(row)
  }

</script>    
</main>
</body>
</html>